(()=>{"use strict";function e(e,t,n,r,o){var a=document.querySelector("#card-template").content.cloneNode(!0);return a.querySelector(".card__title").textContent=e.name,a.querySelector(".card__image").src=e.link,a.querySelector(".card__image").alt=e.alt,a.querySelector(".card__like-count").textContent=e.likes.length,e.likes.some((function(e){return e._id===o._id}))&&a.querySelector(".card__like-button").classList.add("card__like-button_is-active"),e.owner._id===o._id||(a.querySelector(".card__delete-button").style.display="none"),a.querySelector(".card__delete-button").addEventListener("click",t),a.querySelector(".card__image").addEventListener("click",n),a.querySelector(".card__like-button").addEventListener("click",r),a}function t(e){var t=e.target.closest(".card");t&&t.remove()}function n(e){var t=e.target,n=t.closest(".card").querySelector(".card__like-count");t.classList.toggle("card__like-button_is-active"),t.classList.contains("card__like-button_is-active")?n.textContent=parseInt(n.textContent)+1:n.textContent=parseInt(n.textContent)-1}function r(e){e.classList.add("popup_is-animated"),window.addEventListener("keydown",a),setTimeout((function(){e.classList.add("popup_is-opened")}),60)}function o(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keydown",a),setTimeout((function(){e.classList.remove("popup_is-animated")}),60)}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup.popup_is-opened");t&&o(t)}}function c(e){switch(e){case"edit":var t=document.querySelector(".popup_type_edit .popup__input_type_name ~ .error-message"),n=document.querySelector(".popup_type_edit .popup__input_type_description ~ .error-message");t&&(t.textContent=""),n&&(n.textContent="");var r=document.querySelector(".popup_type_edit .popup__input_type_name"),o=document.querySelector(".popup_type_edit .popup__input_type_description");r&&r.classList.contains("invalid")&&r.classList.remove("invalid"),o&&o.classList.contains("invalid")&&o.classList.remove("invalid");break;case"new-place":var a=document.querySelector(".popup_type_new-card .popup__input_place-name ~ .error-message"),c=document.querySelector(".popup_type_new-card .popup__input_link ~ .error-message");a&&(a.textContent=""),c&&(c.textContent="");var u=document.querySelector(".popup_type_new-card .popup__input_place-name"),i=document.querySelector(".popup_type_new-card .popup__input_link");u&&u.classList.contains("invalid")&&u.classList.remove("invalid"),i&&i.classList.contains("invalid")&&i.classList.remove("invalid");break;case"change-avatar":var p=document.querySelector(".popup_type_avatar .popup__input_type_avatar-link ~ .error-message");p&&(p.textContent="");var l=document.querySelector(".popup__input_type_avatar-link");l&&l.classList.contains("invalid")&&l.classList.remove("invalid")}}function u(e){var t=!0;switch(e){case"edit":var n=document.querySelector(".popup_type_edit .popup__input_type_name"),r=document.querySelector(".popup_type_edit .popup__input_type_description"),o=/^[A-Za-zА-Яа-яЁё\s-]+$/,a=document.querySelector(".popup_type_edit .popup__input_type_name ~ .error-message");!a&&n&&(a=p(n));var c=document.querySelector(".popup_type_edit .popup__input_type_description ~ .error-message");return!c&&r&&(c=p(r)),""===n.value?(a.textContent="Вы пропустили это поле",n.classList.add("invalid"),t=!1):n.value.length<2||n.value.length>40?(a.textContent="Имя должно быть от 2 до 40 символов",n.classList.add("invalid"),t=!1):o.test(n.value)?(a.textContent="",n.classList.remove("invalid")):(a.textContent="Поле может содержать только латинские и кириллические буквы, дефисы и пробелы",n.classList.add("invalid"),t=!1),""===r.value?(c.textContent="Вы пропустили это поле",r.classList.add("invalid"),t=!1):r.value.length<2||r.value.length>200?(c.textContent="Описание должно быть от 2 до 200 символов",r.classList.add("invalid"),t=!1):o.test(r.value)?(c.textContent="",r.classList.remove("invalid")):(c.textContent="Поле может содержать только латинские и кириллические буквы, дефисы и пробелы",r.classList.add("invalid"),t=!1),document.querySelector(".popup_type_edit .popup__button").disabled=!t,t;case"new-place":var u=document.querySelector(".popup_type_new-card .popup__input_place-name"),l=document.querySelector(".popup_type_new-card .popup__input_link"),s=document.querySelector(".popup_type_new-card .popup__input_place-name ~ .error-message");!s&&u&&(s=p(u));var d=document.querySelector(".popup_type_new-card .popup__input_link ~ .error-message");return!d&&l&&(d=p(l)),u&&""===u.value?(s.textContent="Вы пропустили это поле",u.classList.add("invalid"),t=!1):u&&(u.value.length<2||u.value.length>30)?(s.textContent="Название должно быть от 2 до 30 символов",u.classList.add("invalid"),t=!1):u&&!/^[A-Za-zА-Яа-яЁё\s-]+$/.test(u.value)?(s.textContent="Поле может содержать только латинские и кириллические буквы, дефисы и пробелы",u.classList.add("invalid"),t=!1):(s&&(s.textContent=""),u&&u.classList.remove("invalid")),l&&""===l.value?(d.textContent="Вы пропустили это поле",l.classList.add("invalid"),t=!1):l&&!i(l.value)?(d.textContent="Некорректный URL",l.classList.add("invalid"),t=!1):(d&&(d.textContent=""),l&&l.classList.remove("invalid")),document.querySelector(".popup_type_new-card .popup__button").disabled=!t,t;case"change-avatar":var _=document.querySelector(".popup__input_type_avatar-link"),m=document.querySelector(".popup_type_avatar .popup__input_type_avatar-link ~ .error-message");return!m&&_&&(m=p(_)),_&&""===_.value?(m.textContent="Вы пропустили это поле",_.classList.add("invalid"),t=!1):_&&!i(_.value)?(m.textContent="Некорректный URL",_.classList.add("invalid"),t=!1):(m&&(m.textContent=""),_&&_.classList.remove("invalid")),document.querySelector(".popup_type_avatar .popup__button").disabled=!t,t}}function i(e){try{return new URL(e),!0}catch(e){return!1}}function p(e){if(e){var t=document.createElement("span");return t.classList.add("error-message"),e.parentNode.insertBefore(t,e.nextSibling),t}}var l,s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-36",headers:{authorization:"6189ef78-03ef-42f1-a1b8-8ca27d9491b7","Content-Type":"application/json"}};function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var _=document.querySelector(".places__list"),m=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),y=(document.querySelector(".popup_type_image"),document.querySelector(".popup_type_avatar"));function f(){return Promise.all([fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){if(!e.ok)throw new Error("Ошибка HTTP: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Ошибка при получении данных пользователя:",e.message),null})),fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){if(!e.ok)throw new Error("Ошибка HTTP: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Ошибка при загрузке карточек:",e.message),[]}))]).then((function(r){var o,a,c=(a=2,function(e){if(Array.isArray(e))return e}(o=r)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,u=[],i=!0,p=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){p=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(p)throw o}}return u}}(o,a)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(o,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],i=c[1];globalThis.userData=u,u?(document.querySelector(".profile__title").textContent=u.name,document.querySelector(".profile__description").textContent=u.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(u.avatar,")")):console.error("Не удалось получить данные пользователя."),i&&i.length>0?function(t,n,r,o,a){t.forEach((function(t){var c=e(t,r,L,o,a);n.appendChild(c)}))}(i,_,t,n,u):console.log("Карточки не найдены или произошла ошибка при их загрузке.")})).catch((function(e){console.error("Ошибка при инициализации приложения:",e.message)}))}document.querySelector(".cards-container");var S=document.querySelector(".profile__title"),q=document.querySelector(".profile__description");null===(l=document.querySelector(".profile__edit-avatar-button"))||void 0===l||l.addEventListener("click",(function(){return r(y)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){x.value=S.textContent,k.value=q.textContent,r(m)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){return r(v)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(e){o(e.currentTarget.closest(".popup"))}))})),document.querySelectorAll(".popup").forEach((function(e){!function(e){e.addEventListener("click",(function(t){t.target.closest(".popup__content")||o(e)}))}(e)}));var g=document.querySelector('.popup__form[name="edit-profile"]');g&&g.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target,r=n.elements.name.value,a=n.elements.description.value,c=n.querySelector(".popup__button"),u=c.textContent;b(c,"Сохранение..."),(t={name:r,about:a},fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify(t)}).then((function(e){if(!e.ok)throw new Error("Ошибка HTTP: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Ошибка при обновлении данных пользователя:",e.message),null}))).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,o(m),C(c,u)})).catch((function(e){console.error("Ошибка при обновлении данных пользователя:",e.message),C(c,u)}))}));var h=document.querySelector('.popup__form[name="new-place"]');function L(e){var t=e.target;if(t.classList.contains("card__image")){var n=t.closest(".places__item").querySelector(".card__title").innerText,o=t.getAttribute("src"),a=t.getAttribute("alt"),c=document.querySelector(".popup_type_image");c.querySelector(".popup__image").setAttribute("src",o),c.querySelector(".popup__image").setAttribute("alt",a),c.querySelector(".popup__caption").textContent=n,r(c)}}function b(e,t){e.textContent=t,e.disabled=!0,e.classList.add("loading")}function C(e,t){e.textContent=t,e.disabled=!1,e.classList.remove("loading")}h&&h.addEventListener("submit",(function(r){r.preventDefault();var a=r.target,p=a.elements["place-name"].value,l=a.elements.link.value;if(i(l)){var d,m=a.querySelector(".popup__button"),v=m.textContent;b(m,"Сохранение..."),(d={name:p,link:l},fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify(d)}).then((function(e){if(!e.ok)throw new Error("Ошибка HTTP: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Ошибка при создании карточки:",e.message),null}))).then((function(r){var i=e(r,t,L,n,globalThis.userData);_.prepend(i),o(a.closest(".popup")),a.reset(),c("new-place"),u("new-place"),C(m,v)})).catch((function(e){console.error("Ошибка при создании карточки:",e.message),C(m,v)}))}else alert("Пожалуйста, введите корректный URL.")}));var x=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_description"),w=document.querySelector(".popup__input_type_avatar-link");if(x.value=document.querySelector(".profile__title").textContent,k.value=document.querySelector(".profile__description").textContent,x.addEventListener("input",(function(){return u("edit")})),k.addEventListener("input",(function(){return u("edit")})),document.querySelector(".popup_type_edit .popup__close").addEventListener("click",(function(){return c("edit")})),h){var E=h.elements["place-name"],T=h.elements.link;E.addEventListener("input",(function(){return u("new-place")})),T.addEventListener("input",(function(){return u("new-place")})),document.querySelector(".popup_type_new-card .popup__close").addEventListener("click",(function(){return c("new-place")}))}w&&w.addEventListener("input",(function(){return u("change-avatar")})),document.querySelector(".popup_type_avatar .popup__close").addEventListener("click",(function(){return c("change-avatar")})),window.onload=function(){f()}})();